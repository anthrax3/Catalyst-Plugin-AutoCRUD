<h3>Welcome to AutoCRUD, an automagic web interface for databases</h3>
<br />

[% IF cpac.dispatch.keys.size == 0 %]
    <p>No database schemas were found in this application. Please contact the site administrator.</p>
    [% RETURN %]

[% ELSE %]
    [% IF cpac.dispatch.exists( cpac_db ) %]
        [% IF cpac.conf.$cpac_db.hidden == 'yes' %]
            [% IF cpac_site == 'default' %]
                <p>Return <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_db') ) %]">
                    Home</a> to select another database.</p>
            [% ELSE %]
                <p>Return <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_schema'), [cpac_site] ) %]">
                    Home</a> to select another database.</p>
            [% END %]
            [% RETURN %]
        [% END %]

        <p>The schema for database &quot;[% cpac.dispatch.$cpac_db.display_name %]&quot; has been loaded,
            so please select a table by clicking on its label, below.</p>
        <br />

        <div id="cpac_navcontainer">
        <ul>
        [% FOREACH t IN cpac.dispatch.$cpac_db.sources.keys.sort %]
            [% NEXT IF cpac.conf.$cpac_db.$t.hidden == 'yes' %]
            <li>
            [% IF cpac_site == 'default' %]
                <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('table'), [cpac_db], t ) %]">
                    [% cpac.dispatch.$cpac_db.sources.$t.display_name %]</a>
            [% ELSE %]
                <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('source'), [cpac_site, cpac_db], t ) %]">
                    [% cpac.dispatch.$cpac_db.sources.$t.display_name %]</a>
            [% END %]
            </li>
        [% END %]
        </ul>
        </div>

        [% IF cpac.dispatch.keys.size > 1 %]
            <br />
            [% IF cpac_site == 'default' %]
                <p>Return <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_db') ) %]">
                    Home</a> to select another database.</p>
            [% ELSE %]
                <p>Return <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_schema'), [cpac_site] ) %]">
                    Home</a> to select another database.</p>
            [% END %]
        [% END %]

    [% ELSE %]
        <p>The following database schemas have been loaded.
            Please select one by clicking on its label, below.</p>
        <br />

        <div id="cpac_navcontainer">
        <ul>
        [% FOREACH d IN cpac.dispatch.keys.sort %]
            [% NEXT IF cpac.conf.$d.hidden == 'yes' %]
            <li>
            [% IF cpac_site == 'default' %]
                <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_table'), [d] ) %]">
                    [% cpac.dispatch.$d.display_name %]</a>
            [% ELSE %]
                <a href="[% c.uri_for( c.controller('AutoCRUD::Root').action_for('no_source'), [cpac_site, d] ) %]">
                    [% cpac.dispatch.$d.display_name %]</a>
            [% END %]
            </li>
        [% END %]
        </ul>
        </div>

    [% END %]
[% END %]
